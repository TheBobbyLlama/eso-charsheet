var localizationLanguage = "EN-US"; // Global variable that other files can access.
const checkAttributes = [ "alt", "title", "placeholder" ];
const localizationList = [
    {
        language: "EN-US",
        strings: [
            [ "ROLLPLAY_TITLE", "ESO Rollplay" ],
            [ "RETURN_TO_DASHBOARD", "Return to Dashboard" ],
            [ "ACCOUNT_OPTIONS", "Account Options" ],
            [ "HANDBOOK", "Handbook"],
            [ "LOGOUT", "Logout" ],
            [ "LOGOUT_CONFIRM", "Log out of your account?" ],
            [ "SESSION_HISTORY", "Session History" ],
            [ "ERROR", "Error" ],
            [ "CONFIRM", "Confirm" ],
            [ "OK", "Ok" ],
            [ "CANCEL", "Cancel" ],
            [ "DONE", "Done" ],
            [ "SEARCH", "Search" ],
            [ "COMMENT", "Comment" ],
            [ "MARKDOWN", "Markdown" ],
            [ "USER_NOT_FOUND", "User USER not found!" ],
            [ "CHARACTER_NOT_FOUND", "Character not found." ],
            [ "THERE_WAS_AN_ERROR_LOADING_THE_CHARACTER", "There was an error loading the character." ],
            [ "ERROR_SESSION_FAILED_TO_LOAD", "Your session failed to load." ],
            [ "OR", "or" ],
            [ "DOUBLE_CLICK_TO_COPY_CHARACTER_SHEET", "Double click to copy character sheet." ],
            [ "NOT_APPLICABLE", "N/A" ],
            [ "LABEL_NAME", "Name:" ],
            [ "SEX_MALE", "Male" ],
            [ "SEX_FEMALE", "Female" ],
            [ "LABEL_ALIGNMENT", "Alignment:" ],
            [ "NOT_SET", "-- Not Set --" ],
            [ "ALIGNMENT_LG", "Lawful Good" ],
            [ "ALIGNMENT_NG", "Neutral Good" ],
            [ "ALIGNMENT_CG", "Chaotic Good" ],
            [ "ALIGNMENT_LN", "Lawful Neutral" ],
            [ "ALIGNMENT_N", "Neutral" ],
            [ "ALIGNMENT_CN", "Chaotic Neutral" ],
            [ "ALIGNMENT_LE", "Lawful Evil" ],
            [ "ALIGNMENT_NE", "Neutral Evil" ],
            [ "ALIGNMENT_CE", "Chaotic Evil" ],
            [ "LABEL_BIRTHSIGN", "Birthsign:" ],
            [ "BIRTHSIGN_APPRENTICE", "The Apprentice" ],
            [ "BIRTHSIGN_ATRONACH", "The Atronach" ],
            [ "BIRTHSIGN_LADY", "The Lady" ],
            [ "BIRTHSIGN_LORD", "The Lord" ],
            [ "BIRTHSIGN_LOVER", "The Lover" ],
            [ "BIRTHSIGN_MAGE", "The Mage" ],
            [ "BIRTHSIGN_RITUAL", "The Ritual" ],
            [ "BIRTHSIGN_SERPENT", "The Serpent" ],
            [ "BIRTHSIGN_SHADOW", "The Shadow" ],
            [ "BIRTHSIGN_STEED", "The Steed" ],
            [ "BIRTHSIGN_THIEF", "The Thief" ],
            [ "BIRTHSIGN_TOWER", "The Tower" ],
            [ "BIRTHSIGN_WARRIOR", "The Warrior" ],
            [ "LABEL_ALIASES", "Aliases:" ],
            [ "LABEL_PRIMARY_RESIDENCE", "Primary Residence:"],
            [ "LABEL_ORGANIZATIONS", "Organizations:" ],
            [ "LABEL_ALLIANCES", "Alliances:" ],
            [ "LABEL_ENEMIES", "Enemies:" ],
            [ "LABEL_RELATIONSHIPS", "Relationships:" ],
            [ "ACTION_ATTACK!", "Attack!" ],
            [ "ACTION_ROLL", "Roll" ],
            [ "ACTION_ROLL!", "Roll!" ],
            [ "ACTION_HIT!", "Hit!" ],
            [ "ACTION_MISS!", "Miss!" ],
            [ "ACTION_SUCCESS!", "Success!" ],
            [ "ACTION_FAILURE!", "Failure!" ],
            [ "ACTION_ALLOW", "Allow" ],
            [ "ACTION_DENY", "Deny" ],
            [ "DISMISS_SUMMON", "Dismiss" ],
            [ "===== Dashboard ====="],
            [ "WELCOME_MESSAGE", "Welcome, USER!" ],
            [ "NEW_PLAYER_WELCOME", "Welcome Aboard!" ],
            [ "NEW_PLAYER_BEFORE_LINK", "Please refer to the" ],
            [ "NEW_PLAYER_AFTER_LINK", "for more information on getting started.  Or dive right in and make your first character!" ],
            [ "MAKE_A_CHARACTER", "Make a Character" ],
            [ "PLEASE_SELECT_A_CHARACTER", "Please select a character." ],
            [ "CREATE_A_NEW_CHARACTER", "Create a New Character" ],
            [ "BUTTON_PLAY", "Play!" ],
            [ "BUTTON_EDIT", "Edit" ],
            [ "BUTTON_DELETE", "Delete" ],
            [ "OTHER_TASKS", "Other Tasks" ],
            [ "GM_SCREEN", "GM SCreen" ],
            [ "BROWSE_CHARACTERS", "Browse Characters" ],
            [ "GENERATE_LORE_FRIENDLY_NAMES", "Generate Lore Friendly Names" ],
            [ "FOOTER_JOIN_THE_DISCUSSION", "Join the discussion:" ],
            [ "FOOTER_GET_THE_ADDON", "Get the addon:" ],
            [ "FOOTER_ADDON_BEFORE_LINK", "in the Roleplay category in" ],
            [ "FOOTER_ADDON_AFTER_LINK", "!" ],
            [ "CONFIRM_DELETE_CHARACTER", "Are you sure you want to delete the character CHARACTER?" ],
            [ "ACCOUNT_SETTINGS", "Account Settings" ],
            [ "ALERT_VOLUME", "Alert Volume" ],
            [ "GAME_MASTER", "Game Master" ],
            [ "GM_SETTING_LINE_1", "Enable this option for access" ],
            [ "GM_SETTING_LINE_2", "to the GM Screen." ],
            [ "LANGUAGE", "Language" ],
            [ "ENGLISH", "English" ],
            [ "PORTUGUESE_BR", "PortuguÃªs do Brasil" ],
            [ "CHANGE_PASSWORD", "Change Password" ],
            [ "NEW_PASSWORD", "New Password" ],
            [ "CONFIRM_PASSWORD", "Confirm Password" ],
            [ "===== Character Sheet ====="],
            [ "GENERATE_RANDOM_NAME", "Generate a random name." ],
            [ "LABEL_RACE", "Race:" ],
            [ "LABEL_SEX", "Sex:" ],
            [ "LABEL_SUPERNATURAL", "Supernatural:" ],
            [ "LABEL_CLASS", "Class:" ],
            [ "SAVE", "Save" ],
            [ "LABEL_ATTRIBUTE_POINTS", "Attribute Points:" ],
            [ "LABEL_SKILL_POINTS", "Skill Points:" ],
            [ "ATTRIBUTES", "Attributes" ],
            [ "COMBAT_SKILLS", "Combat Skills" ],
            [ "MAGICKA_SKILLS", "Magicka Skills" ],
            [ "GENERAL_SKILLS", "General Skills" ],
            [ "CRAFTING_SKILLS", "Crafting Skills" ],
            [ "KNOWLEDGE_SKILLS", "Knowledge Skills" ],
            [ "LABEL_DIFFICULTY", "Difficulty:" ],
            [ "ERROR_EDIT_CHARACTER_NOT_YOURS", "You cannot edit a character that is not yours!" ],
            [ "ERROR_CHARACTER_NAME", "Please enter a character name." ],
            [ "ERROR_OVER_POINT_ALOTMENT", "You are over your point allotment." ],
            [ "ERROR_CHARACTER_OTHER_PLAYER", "This character has already been created by another player! (PLAYER)"],
            [ "CHARACTER_SAVED_SUCCESSFULLY", "Character saved successfully! You may return to the dashboard." ],
            [ "CHARACTER_PROFILE", "Character Profile" ],
            [ "SHORT_DESCRIPTION", "Short Description" ],
            [ "SHORT_DESCRIPTION_DESCRIPTION", "This is what players will see if they click your character during a Rollplay session.  This is a good place to mention physical characteristics and publicly known information about your character!" ],
            [ "SHORT_DESCRIPTION_HELPER", "This is only a summary.  Please be brief! (CURRENT/MAX characters)" ],
            [ "GENERAL_INFORMATION", "General Information" ],
            [ "CHARACTER_IMAGE", "Character Image" ],
            [ "CHARACTER_IMAGE_URL", "Image URL" ],
            [ "ALIASES_DESCRIPTION", "Other names you may go by." ],
            [ "PRIMARY_RESIDENCE_DESCRIPTION", "Where you live." ],
            [ "ORGANIZATIONS_DESCRIPTION", "Any groups you belong to." ],
            [ "ALLIANCES_DESCRIPTION", "Any groups you are friendly to." ],
            [ "ENEMIES_DESCRIPTION", "Any groups or people you are NOT friendly to." ],
            [ "RELATIONSHIPS_DESCRIPTION", "Other characters you are close to." ],
            [ "BIOGRAPHY", "Biography" ],
            [ "BIOGRAPHY_DESCRIPTION", "Write a detailed background here, if you like." ],
            [ "PREVIEW", "Preview" ],
            [ "CHARACTER_HELP_TITLE", "Building Your Character" ],
            [ "NAMERACEETC", "Name/Race/Etc." ],
            [ "CHARACTER_HELP_NAMERACEETC_TEXT", "You must specify a character name to save your character.  Race, sex, and supernatural type have an effect on stats, so be sure to select the appropriate values." ],
            [ "CHARACTER_HELP_ATTRIBUTES_TEXT", "You should begin by choosing your attribute scores. This is a straight 1-for-1 point buy." ],
            [ "SKILLS", "Skills" ],
            [ "CHARACTER_HELP_SKILLS_TEXT", "Skills are added much like attributes, but they increase in cost as you increase in rank. However, the governing attribute of a skill controls how quickly the increase occurs." ],
            [ "CHARACTER_HELP_KNOWLEDGE_SKILLS_TEXT", "Knowledge skills are a special class of skill that always have Intelligence as their governing attribute.  Some are more difficult to learn and increase in difficulty more quickly." ],
            [ "PROFILE_INFO", "Profile Info" ],
            [ "CHARACTER_HELP_PROFILE_INFO_BEFORE_LINK", "Below your skill selections, you can enter more information for your character.  All fields support" ],
            [ "CHARACTER_HELP_PROFILE_INFO_AFTER_LINK", "formatting!" ],
            [ "===== Rollplay Session =====" ],
            [ "LOAD_SESSION", "Load Session" ],
            [ "SESSION_SELECTION", "Session Selection"],
            [ "CHOOSE_SESSION", "Choose the GM of the session you will be joining:" ],
            [ "YOUR_CHARACTER", "Your Character" ],
            [ "CHARACTER_INFO", "Character Info" ],
            [ "LABEL_EQUIPPED", "Equipped:" ],
            [ "LABEL_ARMOR", "Armor:" ],
            [ "PARTY", "Party" ],
            [ "SECTION_MAKE_A_ROLL", "Make a Roll!" ],
            [ "ROLL_USING", "Roll using" ],
            [ "SECTION_PVP", "Player vs. Player" ],
            [ "SECTION_SUMMONING", "Summoning" ],
            [ "ACTION_SUMMON!", "Summon!" ],
            [ "SUMMON_ROLL_CAPTION", "Make a SKILL roll to summon a TEMPLATE." ],
            [ "ENEMIES", "Enemies" ],
            [ "LAZY_MODE", "Lazy mode" ],
            [ "LAZY_MODE_DESCRIPTION", "Any incoming rolls you need to make are resolved automatically." ],
            [ "CLICK_TO_VIEW_PROFILE", "Click to view profile." ],
            [ "TITLE_MAKE_A_ROLL", "Make a Roll" ],
            [ "TITLE_ROLL_NEEDED", "Roll Needed!" ],
            [ "PLAYER_ROLL_CAPTION", "Make a roll using QUALITY." ],
            [ "ATTACK_ROLL_CAPTION", "Make an attack roll using QUALITY." ],
            [ "ATTACK_HIT_CAPTION", "You hit TARGET!  Roll for damage!" ],
            [ "INCOMING_ATTACK_CAPTION", "You have been attacked by NAME!" ],
            [ "INCOMING_HIT_CAPTION", "You have been hit by NAME!" ],
            [ "ROLL_CAPTION", "Roll QUALITY!" ],
            [ "ROLL_AGAINST_OPPONENT_CAPTION", "Roll QUALITY vs. NAME!" ],
            [ "TRANSFORM_INTO", "Transform into FORM" ],
            [ "TRANSFORM_REVERT", "End Transformation" ],
            [ "NOT_PART_OF_SESSION", "This character is not part of an active roleplaying session.  Check with your Game Master."],
            [ "YOU_HAVE_BEEN_REMOVED_FROM_THE_SESSION", "You have been removed from the session." ],
            [ "ERROR_CONNECTED_ELSEWHERE", "Players can only maintain one connection to a session.  This player has connected from somewhere else." ],
            [ "===== GM Screen =====" ],
            [ "CURRENT_SESSION", "Current Session" ],
            [ "OPEN_SESSION", "Open Session" ],
            [ "CONFIRM_NEW_SESSION", "Opening another session will delete the current session." ],
            [ "END_SESSION", "End Session" ],
            [ "CONFIRM_END_SESSION", "Are you sure you want to end the session?" ],
            [ "ADD", "Add" ],
            [ "NEW_NPC_NAME_HERE", "New NPC name here." ],
            [ "ADD_NPC_FROM_TEMPLATE", "Add NPC from template." ],
            [ "NPC_NAME_EXISTS", "An NPC with that name already exists. Please enter a unique name for the NPC." ],
            [ "NPC_NO_NAME", "Please enter a name for the NPC." ],
            [ "CURRENT_NPC", "Current NPC" ],
            [ "LABEL_ATTACK_BONUS", "Attack Bonus:" ],
            [ "LABEL_ATTACK_TYPE", "Attack Type:" ],
            [ "LABEL_DAMAGE_BONUS", "Damage Bonus:" ],
            [ "LABEL_DEFENSE_BONUS", "Defense Bonus:" ],
            [ "LABEL_TOUGHNESS_BONUS", "Toughness Bonus:" ],
            [ "LABEL_RESISTS", "Resists:" ],
            [ "LABEL_WEAK_TO", "Weak to:" ],
            [ "CLICK_TO_VIEWEDIT", "Click to view/edit" ],
            [ "STATUS_HIDDEN", "Hidden" ],
            [ "CONFIRM_REMOVE_NPC", "Remove NPC <b>NAME</b> from the session?" ],
            [ "ERROR_REMOVE_NPC", "Error removing NPC <b>NAME</b> from the session - not found."]
            [ "PLAYERS", "Players" ],
            [ "CHARACTER_NAME_HERE", "Character name here."],
            [ "SEARCH_CHARACTER_BY_ACCOUNT_NAME", "Search for a character by account name." ],
            [ "PLAYER_NO_NAME", "You must enter a character name to add." ],
            [ "PLAYER_IN_SESSION", "This character is already in the session." ],
            [ "CLICK_TO_VIEW", "Click to view" ],
            [ "CONFIRM_REMOVE_PLAYER", "Remove player <b>NAME</b> from the session?"],
            [ "ERROR_REMOVE_PLAYER", "Error removing player <b>NAME</b> from the session - not found." ],
            [ "ROLL_DIE", "Roll die" ],
            [ "TARGET_PLAYER", "Target Player" ],
            [ "PROMPT_FOR_ROLL", "Prompt for Roll" ],
            [ "CONTESTED_ROLL", "Contested Roll" ],
            [ "VS", "vs." ],
            [ "ROLL_AGAINST", "Roll Against" ],
            [ "MAKE_A_GM_POST", "Make a GM Post" ],
            [ "MAKE_POST_HIT_SEND", "Make a post here and hit Send." ],
            [ "SEND", "Send" ],
            [ "ADD_NPC_TEMPLATE", "Add NPC from Template" ],
            [ "ADD_NPC_TEMPLATE_TEXT", "Adding a new NPC:" ],
            [ "ADD_NPC_TEMPLATE_NAME", "Adding NAME:" ],
            [ "PLAYER_SEARCH", "Player Search" ],
            [ "PLAYER_ACCOUNT_NAME", "Player account name" ],
            [ "===== Profile Screen =====" ],
            [ "CHARACTER_PROFILE", "Character Profile" ],
            [ "NO_DESCRIPTION_GIVEN", "No description given." ],
            [ "===== Name Generator =====" ],
            [ "NAME_GENERATOR", "Name Generator" ],
            [ "GENERATE", "Generate" ],
            [ "RESULT_COUNT", "results."],
            [ "RESULTS", "Results" ]
        ]
    }
];

function localize(key) {
    const curLang = localizationList.find(list => list.language === localizationLanguage) || localizationList[0];

    const curLookup = curLang.strings.find(kvPair => kvPair[0] === key) || localizationList[0].strings.find(kvPair => kvPair[0] === key);

    if (curLookup) {
        return curLookup[1];
    } else {
        return key;
    }
}

async function localizePage(language) {
    localizationLanguage = language || "EN-US";
    localStorage.setItem("ESORP[language]", localizationLanguage);

    const localizationTargets = $("*[data-localization-key]");

    localizationTargets.each(function() {
        var element = $(this);
        var key = element.attr("data-localization-key");

        checkAttributes.forEach(item => {
            var checkMe = element.attr(item);
            if (checkMe) {
                element.attr(item, localize(checkMe));
            }
        })

        if (key) {
            element.text(localize(key));
        }
    })
}